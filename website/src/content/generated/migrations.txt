// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type { Database, RunResult, Statement } from "better-sqlite3";

export class Queries {
  private statements = new Map<string, Statement>();

  constructor(private db: Database) {}

  private prepare<
    BindParameters extends unknown[] | {} = unknown[],
    Result = unknown,
  >(id: string, query: string, isPluck = false) {
    let stmt = this.statements.get(id);
    if (!stmt) {
      stmt = this.db.prepare(query);
      if (isPluck) {
        stmt = stmt.pluck();
      }
      this.statements.set(id, stmt);
    }
    return stmt as Statement<BindParameters, Result>;
  }

  static getMigrations(): string[] {
    return [
      `CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  email TEXT UNIQUE,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);`,
      `CREATE TABLE posts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  title TEXT NOT NULL,
  content TEXT,
  FOREIGN KEY (user_id) REFERENCES users(id)
);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([["all_users", "allUsers"]]);
  }

  allUsers(): {
    id: number;
    name: string;
    email: string | null;
    created_at: string | null;
  }[] {
    const stmt = this.prepare<
      [],
      {
        id: number;
        name: string;
        email: string | null;
        created_at: string | null;
      }
    >("all_users", "SELECT * FROM users ORDER BY created_at DESC;");
    return stmt.all();
  }
}
