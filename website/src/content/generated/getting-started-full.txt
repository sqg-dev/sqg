// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type { Database, RunResult, Statement } from "better-sqlite3";

export class Queries {
  private statements = new Map<string, Statement>();

  constructor(private db: Database) {}

  private prepare<
    BindParameters extends unknown[] | {} = unknown[],
    Result = unknown,
  >(id: string, query: string, isPluck = false) {
    let stmt = this.statements.get(id);
    if (!stmt) {
      stmt = this.db.prepare(query);
      if (isPluck) {
        stmt = stmt.pluck();
      }
      this.statements.set(id, stmt);
    }
    return stmt as Statement<BindParameters, Result>;
  }

  static getMigrations(): string[] {
    return [
      `CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT UNIQUE
);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([
      ["all_users", "allUsers"],
      ["get_user", "getUser"],
      ["create_user", "createUser"],
      ["delete_user", "deleteUser"],
    ]);
  }

  allUsers(): { id: number; name: string; email: string | null }[] {
    const stmt = this.prepare<
      [],
      { id: number; name: string; email: string | null }
    >("all_users", "SELECT * FROM users;");
    return stmt.all();
  }
  getUser(
    id: number,
  ): { id: number; name: string; email: string | null } | undefined {
    const stmt = this.prepare<
      [number],
      { id: number; name: string; email: string | null }
    >("get_user", "SELECT * FROM users WHERE id =?;");
    return stmt.get(id);
  }
  createUser(name: string, email: string): RunResult {
    const stmt = this.prepare<[string, string], any>(
      "create_user",
      "INSERT INTO users (name, email) VALUES ( ?, ?);",
    );
    return stmt.run(name, email);
  }
  deleteUser(id: number): RunResult {
    const stmt = this.prepare<[number], any>(
      "delete_user",
      "DELETE FROM users WHERE id =?;",
    );
    return stmt.run(id);
  }
}
