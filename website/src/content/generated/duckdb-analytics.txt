// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type {
  DuckDBConnection,
  DuckDBMaterializedResult,
  DuckDBAppender,
  DuckDBDateValue,
  DuckDBTimeValue,
  DuckDBTimestampValue,
  DuckDBBlobValue,
} from "@duckdb/node-api";

export class Queries {
  constructor(private conn: DuckDBConnection) {}

  static getMigrations(): string[] {
    return [
      `CREATE TABLE orders (
    id INTEGER PRIMARY KEY,
    region VARCHAR NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    order_date DATE NOT NULL
);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([["sales_by_region", "salesByRegion"]]);
  }

  async salesByRegion(
    start_date: string,
    end_date: string,
  ): Promise<
    {
      region: string | null;
      order_count: bigint | null;
      total_sales: { width: number; scale: number; value: bigint } | null;
      avg_order_value: number | null;
    }[]
  > {
    const sql = `SELECT
  region,
  COUNT(*) as order_count,
  SUM(amount) as total_sales,
  AVG(amount) as avg_order_value
FROM orders
WHERE order_date BETWEEN ? AND ?
GROUP BY region
ORDER BY total_sales DESC;`;
    const reader = await this.conn.runAndReadAll(sql, [start_date, end_date]);
    return reader.getRowObjects() as {
      region: string | null;
      order_count: bigint | null;
      total_sales: { width: number; scale: number; value: bigint } | null;
      avg_order_value: number | null;
    }[];
  }
}
