// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type {
  DuckDBConnection,
  DuckDBMaterializedResult,
  DuckDBAppender,
  DuckDBDateValue,
  DuckDBTimeValue,
  DuckDBTimestampValue,
  DuckDBBlobValue,
} from "@duckdb/node-api";

export class Queries {
  constructor(private conn: DuckDBConnection) {}

  static getMigrations(): string[] {
    return [
      `CREATE TABLE users (
  id INTEGER PRIMARY KEY,
  name VARCHAR NOT NULL,
  email VARCHAR UNIQUE,
  metadata STRUCT(role VARCHAR, active BOOLEAN),
  tags VARCHAR[],
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([
      ["all_users", "allUsers"],
      ["get_user", "getUser"],
      ["get_user_tags", "getUserTags"],
      ["create_user", "createUser"],
    ]);
  }

  async allUsers(): Promise<
    {
      id: number | null;
      name: string | null;
      email: string | null;
      metadata: { entries: { role: string | null; active: boolean | null } };
      tags: { items: (string | null)[] };
      created_at: { micros: bigint } | null;
    }[]
  > {
    const sql = "SELECT * FROM users ORDER BY created_at DESC;";
    const reader = await this.conn.runAndReadAll(sql, []);
    return reader.getRowObjects() as {
      id: number | null;
      name: string | null;
      email: string | null;
      metadata: { entries: { role: string | null; active: boolean | null } };
      tags: { items: (string | null)[] };
      created_at: { micros: bigint } | null;
    }[];
  }

  async getUser(
    id: number,
  ): Promise<
    | {
        id: number | null;
        name: string | null;
        email: string | null;
        metadata: { entries: { role: string | null; active: boolean | null } };
        tags: { items: (string | null)[] };
        created_at: { micros: bigint } | null;
      }
    | undefined
  > {
    const sql = "SELECT * FROM users WHERE id =?;";
    const reader = await this.conn.runAndReadAll(sql, [id]);
    return reader.getRowObjects()[0] as
      | {
          id: number | null;
          name: string | null;
          email: string | null;
          metadata: {
            entries: { role: string | null; active: boolean | null };
          };
          tags: { items: (string | null)[] };
          created_at: { micros: bigint } | null;
        }
      | undefined;
  }

  async getUserTags(
    id: number,
  ): Promise<{ items: (string | null)[] } | undefined> {
    const sql = "SELECT tags FROM users WHERE id =?;";
    const reader = await this.conn.runAndReadAll(sql, [id]);
    return reader.getRows()[0]?.[0] as { items: (string | null)[] } | undefined;
  }

  async createUser(
    id: number,
    name: string,
    email: string,
  ): Promise<DuckDBMaterializedResult> {
    const sql = "INSERT INTO users (id, name, email) VALUES ( ?, ?, ?);";
    return await this.conn.run(sql, [id, name, email]);
  }
}
