// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type { Database, RunResult, Statement } from "better-sqlite3";

export class Queries {
  private statements = new Map<string, Statement>();

  constructor(private db: Database) {}

  private prepare<
    BindParameters extends unknown[] | {} = unknown[],
    Result = unknown,
  >(id: string, query: string, isPluck = false) {
    let stmt = this.statements.get(id);
    if (!stmt) {
      stmt = this.db.prepare(query);
      if (isPluck) {
        stmt = stmt.pluck();
      }
      this.statements.set(id, stmt);
    }
    return stmt as Statement<BindParameters, Result>;
  }

  static getMigrations(): string[] {
    return [
      `CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    age INTEGER,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP
);`,
      `CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT,
    views INTEGER DEFAULT 0,
    published INTEGER DEFAULT 0,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);`,
      `CREATE INDEX IF NOT EXISTS idx_posts_user_id ON posts(user_id);
CREATE INDEX IF NOT EXISTS idx_posts_published ON posts(published);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([
      ["insertUser", "insertUser"],
      ["getAllUsers", "getAllUsers"],
      ["getUserById", "getUserById"],
      ["getUserByEmail", "getUserByEmail"],
      ["countUsers", "countUsers"],
      ["insertPost", "insertPost"],
      ["getPostsByUser", "getPostsByUser"],
      ["getPublishedPosts", "getPublishedPosts"],
      ["getPostWithAuthor", "getPostWithAuthor"],
      ["countPostsByUser", "countPostsByUser"],
      ["updatePostViews", "updatePostViews"],
      ["deletePost", "deletePost"],
    ]);
  }

  insertUser(name: string, email: string, age: number): RunResult {
    const stmt = this.prepare<[string, string, number], any>(
      "insertUser",
      "INSERT INTO users (name, email, age) VALUES ( ?, ?, ?);",
    );
    return stmt.run(name, email, age);
  }
  getAllUsers(): {
    id: number;
    name: string;
    email: string;
    age: number | null;
    created_at: string | null;
  }[] {
    const stmt = this.prepare<
      [],
      {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    >("getAllUsers", "SELECT id, name, email, age, created_at FROM users;");
    return stmt.all();
  }
  getUserById(
    id: number,
  ):
    | {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    | undefined {
    const stmt = this.prepare<
      [number],
      {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    >(
      "getUserById",
      "SELECT id, name, email, age, created_at FROM users WHERE id =?;",
    );
    return stmt.get(id);
  }
  getUserByEmail(
    email: string,
  ):
    | {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    | undefined {
    const stmt = this.prepare<
      [string],
      {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    >(
      "getUserByEmail",
      "SELECT id, name, email, age, created_at FROM users WHERE email =?;",
    );
    return stmt.get(email);
  }
  countUsers(): unknown | undefined {
    const stmt = this.prepare<[], unknown>(
      "countUsers",
      "SELECT COUNT(*) FROM users;",
      true,
    );
    return stmt.get();
  }
  insertPost(
    userId: number,
    title: string,
    content: string,
    published: number,
  ): RunResult {
    const stmt = this.prepare<[number, string, string, number], any>(
      "insertPost",
      `INSERT INTO posts (user_id, title, content, published)
VALUES ( ?, ?, ?, ?);`,
    );
    return stmt.run(userId, title, content, published);
  }
  getPostsByUser(
    userId: number,
  ): {
    id: number;
    user_id: number;
    title: string;
    content: string | null;
    views: number | null;
    published: number | null;
    created_at: string | null;
  }[] {
    const stmt = this.prepare<
      [number],
      {
        id: number;
        user_id: number;
        title: string;
        content: string | null;
        views: number | null;
        published: number | null;
        created_at: string | null;
      }
    >(
      "getPostsByUser",
      `SELECT id, user_id, title, content, views, published, created_at
FROM posts WHERE user_id =?;`,
    );
    return stmt.all(userId);
  }
  getPublishedPosts(
    limit: number,
  ): {
    id: number;
    title: string;
    content: string | null;
    views: number | null;
    created_at: string | null;
    author_name: string;
  }[] {
    const stmt = this.prepare<
      [number],
      {
        id: number;
        title: string;
        content: string | null;
        views: number | null;
        created_at: string | null;
        author_name: string;
      }
    >(
      "getPublishedPosts",
      `SELECT p.id, p.title, p.content, p.views, p.created_at, u.name as author_name
FROM posts p
JOIN users u ON p.user_id = u.id
WHERE p.published = 1
ORDER BY p.created_at DESC limit ?;`,
    );
    return stmt.all(limit);
  }
  getPostWithAuthor(
    postId: number,
  ):
    | {
        id: number;
        title: string;
        content: string | null;
        views: number | null;
        created_at: string | null;
        author_id: number;
        author_name: string;
        author_email: string;
      }
    | undefined {
    const stmt = this.prepare<
      [number],
      {
        id: number;
        title: string;
        content: string | null;
        views: number | null;
        created_at: string | null;
        author_id: number;
        author_name: string;
        author_email: string;
      }
    >(
      "getPostWithAuthor",
      `SELECT p.id, p.title, p.content, p.views, p.created_at,
       u.id as author_id, u.name as author_name, u.email as author_email
FROM posts p
JOIN users u ON p.user_id = u.id
WHERE p.id =?;`,
    );
    return stmt.get(postId);
  }
  countPostsByUser(userId: number): unknown | undefined {
    const stmt = this.prepare<[number], unknown>(
      "countPostsByUser",
      "SELECT COUNT(*) FROM posts WHERE user_id =?;",
      true,
    );
    return stmt.get(userId);
  }
  updatePostViews(postId: number, views: number): RunResult {
    const stmt = this.prepare<[number, number], any>(
      "updatePostViews",
      "UPDATE posts SET views =? WHERE id =?;",
    );
    return stmt.run(views, postId);
  }
  deletePost(postId: number): RunResult {
    const stmt = this.prepare<[number], any>(
      "deletePost",
      "DELETE FROM posts WHERE id =?;",
    );
    return stmt.run(postId);
  }
}
