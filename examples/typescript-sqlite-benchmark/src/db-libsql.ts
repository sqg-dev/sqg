// This file is generated by SQG (https://sqg.dev). Do not edit manually.
import type { Client, InArgs } from "@libsql/client";

interface RunResult {
  changes: number;
  lastInsertRowid: bigint;
}

export class Queries {
  constructor(private client: Client) {}

  static getMigrations(): string[] {
    return [
      `CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    age INTEGER,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP
);`,
      `CREATE TABLE IF NOT EXISTS posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    content TEXT,
    views INTEGER DEFAULT 0,
    published INTEGER DEFAULT 0,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);`,
      `CREATE INDEX IF NOT EXISTS idx_posts_user_id ON posts(user_id);
CREATE INDEX IF NOT EXISTS idx_posts_published ON posts(published);`,
    ];
  }

  static getQueryNames(): Map<string, keyof Queries> {
    return new Map([
      ["insertUser", "insertUser"],
      ["getAllUsers", "getAllUsers"],
      ["getUserById", "getUserById"],
      ["getUserByEmail", "getUserByEmail"],
      ["countUsers", "countUsers"],
      ["insertPost", "insertPost"],
      ["getPostsByUser", "getPostsByUser"],
      ["getPublishedPosts", "getPublishedPosts"],
      ["getPostWithAuthor", "getPostWithAuthor"],
      ["countPostsByUser", "countPostsByUser"],
      ["updatePostViews", "updatePostViews"],
      ["deletePost", "deletePost"],
    ]);
  }

  async insertUser(
    id: number,
    name: string,
    email: string,
    age: number,
  ): Promise<RunResult> {
    const result = await this.client.execute({
      sql: "INSERT INTO users (id, name, email, age) VALUES ( ?, ?, ?, ?);",
      args: [id, name, email, age] as InArgs,
    });
    return {
      changes: result.rowsAffected,
      lastInsertRowid: result.lastInsertRowid ?? 0n,
    };
  }
  async getAllUsers(): Promise<
    {
      id: number;
      name: string;
      email: string;
      age: number | null;
      created_at: string | null;
    }[]
  > {
    const result = await this.client.execute({
      sql: "SELECT id, name, email, age, created_at FROM users;",
      args: [] as InArgs,
    });
    return result.rows as unknown[] as {
      id: number;
      name: string;
      email: string;
      age: number | null;
      created_at: string | null;
    }[];
  }
  async getUserById(
    id: number,
  ): Promise<
    | {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    | undefined
  > {
    const result = await this.client.execute({
      sql: "SELECT id, name, email, age, created_at FROM users WHERE id =?;",
      args: [id] as InArgs,
    });
    return (result.rows as unknown[])[0] as
      | {
          id: number;
          name: string;
          email: string;
          age: number | null;
          created_at: string | null;
        }
      | undefined;
  }
  async getUserByEmail(
    email: string,
  ): Promise<
    | {
        id: number;
        name: string;
        email: string;
        age: number | null;
        created_at: string | null;
      }
    | undefined
  > {
    const result = await this.client.execute({
      sql: "SELECT id, name, email, age, created_at FROM users WHERE email =?;",
      args: [email] as InArgs,
    });
    return (result.rows as unknown[])[0] as
      | {
          id: number;
          name: string;
          email: string;
          age: number | null;
          created_at: string | null;
        }
      | undefined;
  }
  async countUsers(): Promise<unknown | undefined> {
    const result = await this.client.execute({
      sql: "SELECT COUNT(*) FROM users;",
      args: [] as InArgs,
    });
    const row = result.rows[0];
    return row ? (Object.values(row)[0] as unknown) : undefined;
  }
  async insertPost(
    userId: number,
    title: string,
    content: string,
    published: number,
  ): Promise<RunResult> {
    const result = await this.client.execute({
      sql: `INSERT INTO posts (user_id, title, content, published)
VALUES ( ?, ?, ?, ?);`,
      args: [userId, title, content, published] as InArgs,
    });
    return {
      changes: result.rowsAffected,
      lastInsertRowid: result.lastInsertRowid ?? 0n,
    };
  }
  async getPostsByUser(
    userId: number,
  ): Promise<
    {
      id: number;
      user_id: number;
      title: string;
      content: string | null;
      views: number | null;
      published: number | null;
      created_at: string | null;
    }[]
  > {
    const result = await this.client.execute({
      sql: `SELECT id, user_id, title, content, views, published, created_at
FROM posts WHERE user_id =?;`,
      args: [userId] as InArgs,
    });
    return result.rows as unknown[] as {
      id: number;
      user_id: number;
      title: string;
      content: string | null;
      views: number | null;
      published: number | null;
      created_at: string | null;
    }[];
  }
  async getPublishedPosts(
    limit: number,
  ): Promise<
    {
      id: number;
      title: string;
      content: string | null;
      views: number | null;
      created_at: string | null;
      author_name: string;
    }[]
  > {
    const result = await this.client.execute({
      sql: `SELECT p.id, p.title, p.content, p.views, p.created_at, u.name as author_name
FROM posts p
JOIN users u ON p.user_id = u.id
WHERE p.published = 1
ORDER BY p.created_at DESC limit ?;`,
      args: [limit] as InArgs,
    });
    return result.rows as unknown[] as {
      id: number;
      title: string;
      content: string | null;
      views: number | null;
      created_at: string | null;
      author_name: string;
    }[];
  }
  async getPostWithAuthor(
    postId: number,
  ): Promise<
    | {
        id: number;
        title: string;
        content: string | null;
        views: number | null;
        created_at: string | null;
        author_id: number;
        author_name: string;
        author_email: string;
      }
    | undefined
  > {
    const result = await this.client.execute({
      sql: `SELECT p.id, p.title, p.content, p.views, p.created_at,
       u.id as author_id, u.name as author_name, u.email as author_email
FROM posts p
JOIN users u ON p.user_id = u.id
WHERE p.id =?;`,
      args: [postId] as InArgs,
    });
    return (result.rows as unknown[])[0] as
      | {
          id: number;
          title: string;
          content: string | null;
          views: number | null;
          created_at: string | null;
          author_id: number;
          author_name: string;
          author_email: string;
        }
      | undefined;
  }
  async countPostsByUser(userId: number): Promise<unknown | undefined> {
    const result = await this.client.execute({
      sql: "SELECT COUNT(*) FROM posts WHERE user_id =?;",
      args: [userId] as InArgs,
    });
    const row = result.rows[0];
    return row ? (Object.values(row)[0] as unknown) : undefined;
  }
  async updatePostViews(postId: number, views: number): Promise<RunResult> {
    const result = await this.client.execute({
      sql: "UPDATE posts SET views =? WHERE id =?;",
      args: [views, postId] as InArgs,
    });
    return {
      changes: result.rowsAffected,
      lastInsertRowid: result.lastInsertRowid ?? 0n,
    };
  }
  async deletePost(postId: number): Promise<RunResult> {
    const result = await this.client.execute({
      sql: "DELETE FROM posts WHERE id =?;",
      args: [postId] as InArgs,
    });
    return {
      changes: result.rowsAffected,
      lastInsertRowid: result.lastInsertRowid ?? 0n,
    };
  }
}
